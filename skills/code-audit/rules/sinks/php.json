{
  "language": "PHP",
  "description": "PHP Web框架 危险函数 (Sink点)",

  "sinks": [
    {
      "name": "eval",
      "pattern": "\\beval\\(",
      "vuln_types": ["rce", "code_injection"],
      "description": "eval - 执行PHP代码",
      "dangerous_param": 0,
      "examples": [
        "eval($userInput)",
        "eval('return ' . $expression . ';')"
      ],
      "cwe": ["CWE-94", "CWE-95"],
      "remediation": "避免使用eval"
    },
    {
      "name": "assert",
      "pattern": "\\bassert\\(",
      "vuln_types": ["rce", "code_injection"],
      "description": "assert - 执行PHP代码（PHP<8）",
      "dangerous_param": 0,
      "examples": [
        "assert($userInput)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免使用assert执行代码"
    },
    {
      "name": "create_function",
      "pattern": "create_function\\(",
      "vuln_types": ["rce", "code_injection"],
      "description": "create_function - 创建匿名函数",
      "dangerous_param": [0, 1],
      "examples": [
        "create_function('$arg', $userCode)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用匿名函数或闭包"
    },
    {
      "name": "preg_replace_e",
      "pattern": "preg_replace\\([^,]*,/e",
      "vuln_types": ["rce", "code_injection"],
      "description": "preg_replace /e修饰符 - 代码执行",
      "dangerous_param": null,
      "examples": [
        "preg_replace('/(.*)/e', $userInput, $data)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用preg_replace_callback"
    },
    {
      "name": "mb_ereg_replace_e",
      "pattern": "mb_ereg_replace\\([^,]*,/e",
      "vuln_types": ["rce", "code_injection"],
      "description": "mb_ereg_replace /e修饰符",
      "dangerous_param": null,
      "examples": [
        "mb_ereg_replace('.*', $userInput, $data, 'e')"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用mb_ereg_replace_callback"
    },
    {
      "name": "system",
      "pattern": "\\bsystem\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "system - 执行系统命令",
      "dangerous_param": 0,
      "examples": [
        "system($userCommand)",
        "system('ls ' . $directory)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用escapeshellarg()或避免shell命令"
    },
    {
      "name": "exec",
      "pattern": "\\bexec\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "exec - 执行系统命令",
      "dangerous_param": 0,
      "examples": [
        "exec($userCommand, $output)",
        "exec('cat ' . $filename)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用escapeshellarg()"
    },
    {
      "name": "shell_exec",
      "pattern": "shell_exec\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "shell_exec - 执行shell命令",
      "dangerous_param": 0,
      "examples": [
        "shell_exec($userCommand)",
        "$output = shell_exec('ping ' . $host)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用escapeshellarg()"
    },
    {
      "name": "passthru",
      "pattern": "passthru\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "passthru - 执行命令并输出",
      "dangerous_param": 0,
      "examples": [
        "passthru($userCommand)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用escapeshellarg()"
    },
    {
      "name": "popen",
      "pattern": "popen\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "popen - 进程打开",
      "dangerous_param": 0,
      "examples": [
        "popen($userCommand, 'r')",
        "$handle = popen('ls ' . $dir, 'r')"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用escapeshellarg()"
    },
    {
      "name": "proc_open",
      "pattern": "proc_open\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "proc_open - 执行命令",
      "dangerous_param": 0,
      "examples": [
        "proc_open($userCommand, $descriptors, $pipes)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用数组参数，避免shell字符串"
    },
    {
      "name": "pcntl_exec",
      "pattern": "pcntl_exec\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "pcntl_exec - 执行程序",
      "dangerous_param": 0,
      "examples": [
        "pcntl_exec($userPath, $args)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "白名单验证路径"
    },
    {
      "name": "backtick_operator",
      "pattern": "`[^`]*`",
      "vuln_types": ["command_injection", "rce"],
      "description": "反引号操作符 - 命令执行",
      "dangerous_param": null,
      "examples": [
        "`$userCommand`",
        "$output = `ls $directory`"
      ],
      "cwe": ["CWE-78"],
      "remediation": "避免反引号，使用escapeshellarg()"
    },
    {
      "name": "mysqli_query",
      "pattern": "(?:mysqli_query|mysqli_real_query|mysqli_multi_query)\\(",
      "vuln_types": ["sqli"],
      "description": "mysqli_query - SQL注入",
      "dangerous_param": 1,
      "examples": [
        "mysqli_query($conn, 'SELECT * FROM users WHERE id = ' . $id)",
        "$mysqli->query('SELECT * FROM users WHERE name = \\'' . $name . '\\'')"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用参数化查询prepared statements"
    },
    {
      "name": "mysql_query",
      "pattern": "mysql_query\\(",
      "vuln_types": ["sqli"],
      "description": "mysql_query - SQL注入（已废弃）",
      "dangerous_param": 0,
      "examples": [
        "mysql_query('SELECT * FROM users WHERE id = ' . $id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "迁移到mysqli或PDO，使用参数化"
    },
    {
      "name": "pdo_query",
      "pattern": "PDO::query\\(",
      "vuln_types": ["sqli"],
      "description": "PDO::query - SQL注入",
      "dangerous_param": 0,
      "examples": [
        "$pdo->query('SELECT * FROM users WHERE id = ' . $id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用prepare()和execute()"
    },
    {
      "name": "pdo_exec",
      "pattern": "PDO::exec\\(",
      "vuln_types": ["sqli"],
      "description": "PDO::exec - SQL注入",
      "dangerous_param": 0,
      "examples": [
        "$pdo->exec('UPDATE users SET name = \\'' . $name . '\\'')"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用prepare()和execute()"
    },
    {
      "name": "laravel_raw",
      "pattern": "(?:DB::|\\$this->db\\-|\\$this->db->)->(?:select|raw|statement)\\(",
      "vuln_types": ["sqli"],
      "description": "Laravel原始SQL",
      "dangerous_param": null,
      "frameworks": ["laravel"],
      "examples": [
        "DB::select('SELECT * FROM users WHERE id = ' . $id)",
        "DB::raw('SELECT * FROM users WHERE name = \\'' . $name . '\\'')"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用查询构建器或参数绑定"
    },
    {
      "name": "doctrine_raw",
      "pattern": "\\$em->createQuery\\(",
      "vuln_types": ["sqli"],
      "description": "Doctrine DQL注入",
      "dangerous_param": 0,
      "modules": ["doctrine"],
      "examples": [
        "$em->createQuery('SELECT u FROM User u WHERE u.id = ' . $id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用setParameter绑定参数"
    },
    {
      "name": "file_get_contents",
      "pattern": "file_get_contents\\(",
      "vuln_types": ["path_traversal", "file_disclosure", "ssrf"],
      "description": "file_get_contents - 文件读取/SSRF",
      "dangerous_param": 0,
      "examples": [
        "file_get_contents('/path/' . $filename)",
        "file_get_contents($userUrl)"
      ],
      "cwe": ["CWE-22", "CWE-918"],
      "remediation": "验证并规范化路径，URL白名单"
    },
    {
      "name": "file_put_contents",
      "pattern": "file_put_contents\\(",
      "vuln_types": ["path_traversal", "arbitrary_file_write"],
      "description": "file_put_contents - 文件写入",
      "dangerous_param": 0,
      "examples": [
        "file_put_contents('/path/' . $filename, $content)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "fopen",
      "pattern": "\\bfopen\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "fopen - 打开文件",
      "dangerous_param": 0,
      "examples": [
        "fopen('/path/' . $filename, 'r')"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "readfile",
      "pattern": "readfile\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "readfile - 读取文件",
      "dangerous_param": 0,
      "examples": [
        "readfile('/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "file",
      "pattern": "\\bfile\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "file - 读取文件到数组",
      "dangerous_param": 0,
      "examples": [
        "file('/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "unlink",
      "pattern": "\\bulink\\(",
      "vuln_types": ["path_traversal", "file_deletion"],
      "description": "unlink - 删除文件",
      "dangerous_param": 0,
      "examples": [
        "unlink('/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "include",
      "pattern": "(?:include|require|include_once|require_once)\\(",
      "vuln_types": ["file_inclusion", "lfi", "rfi"],
      "description": "include/require - 文件包含",
      "dangerous_param": 0,
      "examples": [
        "include $userFile",
        "require '/path/' . $filename",
        "include_once $template"
      ],
      "cwe": ["CWE-98"],
      "remediation": "白名单验证文件路径"
    },
    {
      "name": "file_exists",
      "pattern": "file_exists\\(",
      "vuln_types": ["path_traversal"],
      "description": "file_exists - 检查文件存在",
      "dangerous_param": 0,
      "examples": [
        "file_exists('/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "is_file",
      "pattern": "\\bis_file\\(",
      "vuln_types": ["path_traversal"],
      "description": "is_file - 检查是否文件",
      "dangerous_param": 0,
      "examples": [
        "is_file('/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "is_dir",
      "pattern": "\\bis_dir\\(",
      "vuln_types": ["path_traversal"],
      "description": "is_dir - 检查是否目录",
      "dangerous_param": 0,
      "examples": [
        "is_dir('/path/' . $dirname)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "scandir",
      "pattern": "scandir\\(",
      "vuln_types": ["path_traversal"],
      "description": "scandir - 列出目录",
      "dangerous_param": 0,
      "examples": [
        "scandir('/path/' . $dirname)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "glob",
      "pattern": "\\bglob\\(",
      "vuln_types": ["path_traversal"],
      "description": "glob - 文件匹配",
      "dangerous_param": 0,
      "examples": [
        "glob('/path/' . $pattern)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "curl_exec",
      "pattern": "curl_exec\\(",
      "vuln_types": ["ssrf", "url_redirection"],
      "description": "curl_exec - SSRF",
      "dangerous_param": null,
      "modules": ["curl"],
      "examples": [
        "curl_exec($ch)",
        "curl_init($userUrl)"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "file_get_contents_url",
      "pattern": "file_get_contents\\s*\\(\\s*['\"]https?://",
      "vuln_types": ["ssrf"],
      "description": "file_get_contents URL - SSRF",
      "dangerous_param": null,
      "examples": [
        "file_get_contents('http://' . $host . '/path')"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "get_headers",
      "pattern": "get_headers\\(",
      "vuln_types": ["ssrf"],
      "description": "get_headers - SSRF",
      "dangerous_param": 0,
      "examples": [
        "get_headers($userUrl)"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "fsockopen",
      "pattern": "fsockopen\\(",
      "vuln_types": ["ssrf"],
      "description": "fsockopen - SSRF",
      "dangerous_param": 0,
      "examples": [
        "fsockopen($host, $port)"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证host，使用白名单"
    },
    {
      "name": "header",
      "pattern": "\\bheader\\(",
      "vuln_types": ["open_redirect", "header_injection"],
      "description": "header - HTTP头注入",
      "dangerous_param": 0,
      "examples": [
        "header('Location: ' . $userUrl)",
        "header('X-Forwarded-For: ' . $ip)"
      ],
      "cwe": ["CWE-601"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "mail",
      "pattern": "\\bmail\\(",
      "vuln_types": ["header_injection"],
      "description": "mail - 邮件头注入",
      "dangerous_param": null,
      "examples": [
        "mail($to, $subject, $body, $headers)"
      ],
      "cwe": ["CWE-93"],
      "remediation": "过滤\\r\\n字符"
    },
    {
      "name": "unserialize",
      "pattern": "\\bunserialize\\(",
      "vuln_types": ["deserialization", "rce"],
      "description": "unserialize - 反序列化RCE",
      "dangerous_param": 0,
      "examples": [
        "unserialize($userData)",
        "unserialize($_COOKIE['data'])"
      ],
      "cwe": ["CWE-502"],
      "remediation": "使用JSON而非serialize，或使用allowed_classes"
    },
    {
      "name": "simplexml_load",
      "pattern": "simplexml_load_(?:string|file)\\(",
      "vuln_types": ["xxe"],
      "description": "SimpleXML - XXE",
      "dangerous_param": 0,
      "examples": [
        "simplexml_load_string($userXML)",
        "simplexml_load_file($filename)"
      ],
      "cwe": ["CWE-611"],
      "remediation": "禁用libxml外部实体"
    },
    {
      "name": "domdocument_load",
      "pattern": "DOMDocument::(?:load|loadXML|loadHTML)\\(",
      "vuln_types": ["xxe"],
      "description": "DOMDocument - XXE",
      "dangerous_param": 0,
      "examples": [
        "$dom->loadXML($userXML)",
        "$dom->load($filename)"
      ],
      "cwe": ["CWE-611"],
      "remediation": "禁用外部实体LIBXML_NOENT"
    },
    {
      "name": "extract",
      "pattern": "\\bextract\\(",
      "vuln_types": ["variable_injection"],
      "description": "extract - 变量覆盖",
      "dangerous_param": 0,
      "examples": [
        "extract($_POST)",
        "extract($userArray)"
      ],
      "cwe": ["CWE-20"],
      "remediation": "避免使用extract或使用EXTR_SKIP"
    },
    {
      "name": "import_request_variables",
      "pattern": "import_request_variables\\(",
      "vuln_types": ["variable_injection"],
      "description": "import_request_variables - 变量导入",
      "dangerous_param": null,
      "examples": [
        "import_request_variables('GPC')"
      ],
      "cwe": ["CWE-20"],
      "remediation": "避免使用，已废弃"
    },
    {
      "name": "mysqli_stmt_prepare",
      "pattern": "mysqli_stmt::prepare|mysqli_prepare\\(",
      "vuln_types": ["sqli"],
      "description": "mysqli prepare - SQL注入",
      "dangerous_param": 0,
      "examples": [
        "$stmt->prepare('SELECT * FROM users WHERE id = ' . $id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用?占位符而非拼接"
    },
    {
      "name": "echo_print",
      "pattern": "(?:echo|print)\\s*\\(",
      "vuln_types": ["xss", "reflected_xss"],
      "description": "echo/print - XSS",
      "dangerous_param": 0,
      "examples": [
        "echo $userInput",
        "print '<div>' . $name . '</div>'"
      ],
      "cwe": ["CWE-79"],
      "remediation": "使用htmlspecialchars()"
    },
    {
      "name": "printf_vprintf",
      "pattern": "(?:printf|vprintf|sprintf)\\(",
      "vuln_types": ["xss", "format_string"],
      "description": "printf - 格式化字符串/XSS",
      "dangerous_param": null,
      "examples": [
        "printf($userInput)",
        "printf('<div>%s</div>', $name)"
      ],
      "cwe": ["CWE-79", "CWE-134"],
      "remediation": "使用%s占位符，htmlspecialchars()"
    },
    {
      "name": "twig_render",
      "pattern": "(?:Twig_Environment::render|\\$this->render\\()->render)\\(",
      "vuln_types": ["ssti"],
      "description": "Twig模板 - SSTI",
      "dangerous_param": 0,
      "modules": ["twig"],
      "examples": [
        "$twig->render($userTemplate)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用固定模板名"
    },
    {
      "name": "smarty_fetch",
      "pattern": "Smarty::(?:fetch|display)\\(",
      "vuln_types": ["ssti"],
      "description": "Smarty模板 - SSTI",
      "dangerous_param": 0,
      "modules": ["smarty"],
      "examples": [
        "$smarty->fetch($userTemplate)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用固定模板名"
    },
    {
      "name": "blade_render",
      "pattern": "\\$blade->make\\(",
      "vuln_types": ["ssti"],
      "description": "Blade模板 - SSTI",
      "dangerous_param": 0,
      "modules": ["illuminate/view"],
      "examples": [
        "$blade->make($userTemplate)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用固定模板名"
    },
    {
      "name": "var_dump_print_r",
      "pattern": "(?:var_dump|print_r)\\(",
      "vuln_types": ["info_disclosure"],
      "description": "var_dump/print_r - 信息泄露",
      "dangerous_param": 0,
      "examples": [
        "var_dump($_SERVER)",
        "print_r($user)"
      ],
      "cwe": ["CWE-200"],
      "remediation": "避免在生产环境输出调试信息"
    },
    {
      "name": "error_log",
      "pattern": "error_log\\(",
      "vuln_types": ["log_injection"],
      "description": "error_log - 日志注入",
      "dangerous_param": 0,
      "examples": [
        "error_log('User input: ' . $userInput)"
      ],
      "cwe": ["CWE-117"],
      "remediation": "对日志输出清理"
    },
    {
      "name": "move_uploaded_file",
      "pattern": "move_uploaded_file\\(",
      "vuln_types": ["path_traversal"],
      "description": "move_uploaded_file - 路径遍历",
      "dangerous_param": 1,
      "examples": [
        "move_uploaded_file($_FILES['file']['tmp_name'], '/path/' . $filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化目标路径"
    },
    {
      "name": "copy",
      "pattern": "\\bcopy\\(",
      "vuln_types": ["path_traversal"],
      "description": "copy - 文件复制",
      "dangerous_param": [0, 1],
      "examples": [
        "copy('/path/' . $source, '/path/' . $dest)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "rename",
      "pattern": "\\brename\\(",
      "vuln_types": ["path_traversal"],
      "description": "rename - 文件重命名",
      "dangerous_param": [0, 1],
      "examples": [
        "rename('/path/' . $old, '/path/' . $new)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "symlink",
      "pattern": "\\bsymlink\\(",
      "vuln_types": ["path_traversal"],
      "description": "symlink - 创建符号链接",
      "dangerous_param": [0, 1],
      "examples": [
        "symlink('/path/' . $target, '/path/' . $link)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "json_decode",
      "pattern": "json_decode\\(",
      "vuln_types": ["prototype_pollution"],
      "description": "json_decode - 原型链污染",
      "dangerous_param": 0,
      "examples": [
        "json_decode('{\"__proto__\": {\"admin\": true}}')"
      ],
      "cwe": ["CWE-1321"],
      "remediation": "验证JSON结构"
    },
    {
      "name": "highlight_file",
      "pattern": "highlight_file\\(",
      "vuln_types": ["path_traversal", "source_disclosure"],
      "description": "highlight_file - 源码泄露",
      "dangerous_param": 0,
      "examples": [
        "highlight_file($userFile)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "白名单验证"
    },
    {
      "name": "show_source",
      "pattern": "show_source\\(",
      "vuln_types": ["path_traversal", "source_disclosure"],
      "description": "show_source - 源码泄露",
      "dangerous_param": 0,
      "examples": [
        "show_source($userFile)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "白名单验证"
    },
    {
      "name": "php_strip_whitespace",
      "pattern": "php_strip_whitespace\\(",
      "vuln_types": ["path_traversal", "source_disclosure"],
      "description": "php_strip_whitespace - 源码泄露",
      "dangerous_param": 0,
      "examples": [
        "php_strip_whitespace($userFile)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "白名单验证"
    }
  ]
}
