{
  "language": "Python",
  "description": "Python Web框架 危险函数 (Sink点)",

  "sinks": [
    {
      "name": "os_system",
      "pattern": "os\\.system\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "os.system - 执行系统命令",
      "dangerous_param": 0,
      "modules": ["os"],
      "examples": [
        "os.system(userCommand)",
        "os.system('ls ' + directory)"
      ],
      "cwe": ["CWE-78", "CWE-77"],
      "remediation": "使用subprocess.run()并设置shell=False"
    },
    {
      "name": "os_popen",
      "pattern": "os\\.popen\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "os.popen - 执行命令并读取输出",
      "dangerous_param": 0,
      "modules": ["os"],
      "examples": [
        "os.popen(userCommand)",
        "result = os.popen('cat ' + filename).read()"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用subprocess.run()并设置shell=False"
    },
    {
      "name": "subprocess_call_shell",
      "pattern": "subprocess\\.(?:call|run|Popen)\\([^)]*shell\\s*=\\s*True",
      "vuln_types": ["command_injection", "rce"],
      "description": "subprocess with shell=True - 命令注入",
      "dangerous_param": null,
      "modules": ["subprocess"],
      "examples": [
        "subprocess.call(userCommand, shell=True)",
        "subprocess.run('ls ' + dirname, shell=True)",
        "subprocess.Popen(userCmd, shell=True)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "设置shell=False，使用列表形式传参"
    },
    {
      "name": "subprocess_call",
      "pattern": "subprocess\\.(?:call|run|check_call|check_output)\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "subprocess函数 - 命令注入",
      "dangerous_param": 0,
      "modules": ["subprocess"],
      "examples": [
        "subprocess.call(userCommand)",
        "subprocess.run(command)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用列表形式传参，shell=False"
    },
    {
      "name": "subprocess_popen",
      "pattern": "subprocess\\.Popen\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "subprocess.Popen - 命令注入",
      "dangerous_param": 0,
      "modules": ["subprocess"],
      "examples": [
        "subprocess.Popen(userCommand, shell=True)",
        "proc = subprocess.Popen(cmd)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用列表形式，避免shell=True"
    },
    {
      "name": "commands_getoutput",
      "pattern": "commands\\.(?:getoutput|getstatusoutput)\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "commands模块 - 命令注入（已废弃）",
      "dangerous_param": 0,
      "modules": ["commands"],
      "examples": [
        "commands.getoutput(userCommand)",
        "commands.getstatusoutput('ls ' + dir)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用subprocess模块"
    },
    {
      "name": "eval_builtin",
      "pattern": "\\beval\\(",
      "vuln_types": ["rce", "code_injection"],
      "description": "eval - 执行Python代码",
      "dangerous_param": 0,
      "examples": [
        "eval(userInput)",
        "result = eval('2 + ' + number)"
      ],
      "cwe": ["CWE-94", "CWE-95"],
      "remediation": "避免使用eval，使用ast.literal_eval()"
    },
    {
      "name": "exec_builtin",
      "pattern": "\\bexec\\(",
      "vuln_types": ["rce", "code_injection"],
      "description": "exec - 执行Python代码",
      "dangerous_param": 0,
      "examples": [
        "exec(userInput)",
        "exec('import ' + module)"
      ],
      "cwe": ["CWE-94", "CWE-95"],
      "remediation": "避免使用exec"
    },
    {
      "name": "compile_builtin",
      "pattern": "\\bcompile\\(",
      "vuln_types": ["code_injection"],
      "description": "compile - 编译代码为字节码",
      "dangerous_param": 0,
      "examples": [
        "compile(userInput, '<string>', 'exec')"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免编译用户代码"
    },
    {
      "name": "__import__",
      "pattern": "__import__\\(",
      "vuln_types": ["code_injection", "file_inclusion"],
      "description": "__import__ - 动态导入模块",
      "dangerous_param": 0,
      "examples": [
        "__import__(userModule)",
        "__import__('os.' + module)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用importlib并验证模块名"
    },
    {
      "name": "pickle_load",
      "pattern": "pickle\\.load(?:s)?\\(",
      "vuln_types": ["deserialization", "rce"],
      "description": "pickle.load/loads - 反序列化RCE",
      "dangerous_param": 0,
      "modules": ["pickle", "cPickle"],
      "examples": [
        "pickle.load(userFile)",
        "obj = pickle.loads(userData)"
      ],
      "cwe": ["CWE-502"],
      "remediation": "使用json或验证pickle数据来源"
    },
    {
      "name": "shelve_open",
      "pattern": "shelve\\.open\\(",
      "vuln_types": ["deserialization"],
      "description": "shelve.open - 打开shelf文件",
      "dangerous_param": 0,
      "modules": ["shelve"],
      "examples": [
        "shelve.open(userFile)"
      ],
      "cwe": ["CWE-502"],
      "remediation": "验证文件路径"
    },
    {
      "name": "yaml_load",
      "pattern": "yaml\\.load\\(",
      "vuln_types": ["deserialization", "rce"],
      "description": "yaml.load - YAML反序列化RCE",
      "dangerous_param": 0,
      "modules": ["yaml"],
      "examples": [
        "yaml.load(userData)",
        "yaml.load(stream, Loader=yaml.Loader)"
      ],
      "cwe": ["CWE-502"],
      "remediation": "使用yaml.safe_load()"
    },
    {
      "name": "marshal_load",
      "pattern": "marshal\\.load(?:s)?\\(",
      "vuln_types": ["deserialization", "rce"],
      "description": "marshal.load - 反序列化",
      "dangerous_param": 0,
      "modules": ["marshal"],
      "examples": [
        "marshal.load(userFile)",
        "marshal.loads(userData)"
      ],
      "cwe": ["CWE-502"],
      "remediation": "避免反序列化不可信数据"
    },
    {
      "name": "sqlalchemy_execute",
      "pattern": "(?:execute|executemany)\\(",
      "vuln_types": ["sqli"],
      "description": "SQLAlchemy执行 - SQL注入",
      "dangerous_param": 0,
      "modules": ["sqlalchemy"],
      "examples": [
        "connection.execute('SELECT * FROM users WHERE id = ' + id)",
        "session.execute('UPDATE users SET name = \'' + name + \"'\")"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用参数化查询 :param 方式"
    },
    {
      "name": "sqlite3_execute",
      "pattern": "(?:execute|executemany|executescript)\\(",
      "vuln_types": ["sqli"],
      "description": "sqlite3执行 - SQL注入",
      "dangerous_param": 0,
      "modules": ["sqlite3"],
      "examples": [
        "cursor.execute('SELECT * FROM users WHERE id = ' + id)",
        "cursor.execute('SELECT * FROM users WHERE name = ?', (name,))"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用?占位符参数化查询"
    },
    {
      "name": "psycopg2_execute",
      "pattern": "(?:execute|executemany)\\(",
      "vuln_types": ["sqli"],
      "description": "psycopg2执行 - SQL注入",
      "dangerous_param": 0,
      "modules": ["psycopg2", "psycopg"],
      "examples": [
        "cursor.execute('SELECT * FROM users WHERE id = ' + id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用%s占位符参数化查询"
    },
    {
      "name": "pymysql_execute",
      "pattern": "(?:execute|executemany)\\(",
      "vuln_types": ["sqli"],
      "description": "PyMySQL执行 - SQL注入",
      "dangerous_param": 0,
      "modules": ["pymysql", "MySQLdb"],
      "examples": [
        "cursor.execute('SELECT * FROM users WHERE id = ' + id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用%s占位符参数化查询"
    },
    {
      "name": "django_raw",
      "pattern": "\\.raw\\(",
      "vuln_types": ["sqli"],
      "description": "Django raw() - 原始SQL",
      "dangerous_param": 0,
      "modules": ["django.db"],
      "examples": [
        "User.objects.raw('SELECT * FROM users WHERE id = ' + id)"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用参数化查询或Django ORM"
    },
    {
      "name": "django_query_extra",
      "pattern": "\\.extra\\(",
      "vuln_types": ["sqli"],
      "description": "Django extra() - 额外SQL",
      "dangerous_param": null,
      "modules": ["django.db"],
      "examples": [
        "User.objects.extra(where=['id = ' + id])"
      ],
      "cwe": ["CWE-89"],
      "remediation": "使用Django ORM查询方法"
    },
    {
      "name": "pymongo_find",
      "pattern": "(?:find|find_one|find_and_modify)\\(",
      "vuln_types": ["nosql_injection"],
      "description": "PyMongo查询 - NoSQL注入",
      "dangerous_param": 0,
      "modules": ["pymongo"],
      "examples": [
        "db.users.find(json.loads(query))",
        "collection.find({'name': request.args.get('name')})"
      ],
      "cwe": ["CWE-943"],
      "remediation": "验证JSON结构，使用$eq等操作符"
    },
    {
      "name": "open_file",
      "pattern": "\\bopen\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "open() - 读取文件",
      "dangerous_param": 0,
      "examples": [
        "open('/path/' + filename)",
        "open(userPath, 'r')"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化文件路径"
    },
    {
      "name": "pathlib_read",
      "pattern": "Path\\([^)]+\\)\\.read\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "Path.read - 读取文件",
      "dangerous_param": null,
      "modules": ["pathlib"],
      "examples": [
        "Path('/path/' + filename).read_text()"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化文件路径"
    },
    {
      "name": "file_read",
      "pattern": "file\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "file() - 读取文件",
      "dangerous_param": 0,
      "examples": [
        "file('/path/' + filename).read()"
      ],
      "cwe": ["CWE-22"],
      "remediation": "使用with open()并验证路径"
    },
    {
      "name": "io_open",
      "pattern": "io\\.open\\(",
      "vuln_types": ["path_traversal", "file_disclosure"],
      "description": "io.open - 读取文件",
      "dangerous_param": 0,
      "modules": ["io"],
      "examples": [
        "io.open('/path/' + filename)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化文件路径"
    },
    {
      "name": "os_readlink",
      "pattern": "os\\.readlink\\(",
      "vuln_types": ["path_traversal"],
      "description": "os.readlink - 读取符号链接",
      "dangerous_param": 0,
      "modules": ["os"],
      "examples": [
        "os.readlink(userPath)"
      ],
      "cwe": ["CWE-22"],
      "remediation": "验证并规范化路径"
    },
    {
      "name": "urllib_request",
      "pattern": "(?:urllib|urllib2|urllib\\.request|requests)\\.(?:urlopen|request|get|post)\\(",
      "vuln_types": ["ssrf", "url_redirection"],
      "description": "HTTP请求 - SSRF",
      "dangerous_param": 0,
      "modules": ["urllib", "urllib2", "requests"],
      "examples": [
        "urllib.urlopen(userUrl)",
        "requests.get(url)",
        "requests.post(targetUrl, data=data)"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "httpclient_request",
      "pattern": "http\\.client\\.(?:request|getresponse)\\(",
      "vuln_types": ["ssrf"],
      "description": "http.client请求 - SSRF",
      "dangerous_param": null,
      "modules": ["http.client"],
      "examples": [
        "http.client.request('GET', userUrl)"
      ],
      "cwe": ["CWE-918"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "render_template",
      "pattern": "(?:render_template|render_template_string)\\(",
      "vuln_types": ["ssti"],
      "description": "Flask/Jinja2渲染 - SSTI",
      "dangerous_param": [0, 1],
      "modules": ["flask", "jinja2"],
      "examples": [
        "render_template(templateName)",
        "render_template_string(userTemplate)",
        "render_template_string('Hello ' + name)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用固定模板名，避免渲染用户字符串"
    },
    {
      "name": "jinja2_template",
      "pattern": "jinja2\\.Template\\(",
      "vuln_types": ["ssti"],
      "description": "Jinja2模板 - SSTI",
      "dangerous_param": 0,
      "modules": ["jinja2"],
      "examples": [
        "jinja2.Template(userString)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免从用户输入创建模板"
    },
    {
      "name": "django_render",
      "pattern": "render\\(",
      "vuln_types": ["ssti"],
      "description": "Django render - SSTI",
      "dangerous_param": 1,
      "modules": ["django.shortcuts"],
      "examples": [
        "render(request, userTemplate)",
        "render(request, 'base.html', {'data': userInput})"
      ],
      "cwe": ["CWE-94"],
      "remediation": "使用固定模板名"
    },
    {
      "name": "format_string",
      "pattern": "\\.(?:format|__format__|format_map)\\(",
      "vuln_types": ["format_string"],
      "description": "format字符串 - 格式化字符串注入",
      "dangerous_param": null,
      "examples": [
        "'Hello {name}'.format(**userDict)",
        "'{data.__class__}'.format(data=userInput)"
      ],
      "cwe": ["CWE-134"],
      "remediation": "使用位置参数或命名参数"
    },
    {
      "name": "percent_format",
      "pattern": "%s|%r|%d",
      "vuln_types": ["format_string"],
      "description": "%格式化 - 格式化字符串",
      "dangerous_param": null,
      "examples": [
        "'Hello %s' % userInput"
      ],
      "cwe": ["CWE-134"],
      "remediation": "使用str.format()或f-strings"
    },
    {
      "name": "xml_etree_parse",
      "pattern": "(?:ElementTree|etree)\\.(?:fromstring|parse|XML)\\(",
      "vuln_types": ["xxe"],
      "description": "ElementTree解析 - XXE",
      "dangerous_param": 0,
      "modules": ["xml.etree.ElementTree", "lxml.etree"],
      "examples": [
        "ElementTree.fromstring(userXML)",
        "etree.parse(userFile)"
      ],
      "cwe": ["CWE-611"],
      "remediation": "禁用DTD和实体解析"
    },
    {
      "name": "lxml_xml_parse",
      "pattern": "lxml\\.(?:etree|fromstring|parse)\\(",
      "vuln_types": ["xxe"],
      "description": "lxml解析 - XXE",
      "dangerous_param": 0,
      "modules": ["lxml"],
      "examples": [
        "lxml.etree.fromstring(userXML)"
      ],
      "cwe": ["CWE-611"],
      "remediation": "设置resolve_entities=False"
    },
    {
      "name": "minidom_parse",
      "pattern": "xml\\.dom\\.minidom\\.(?:parseString|parse)\\(",
      "vuln_types": ["xxe"],
      "description": "minidom解析 - XXE",
      "dangerous_param": 0,
      "modules": ["xml.dom.minidom"],
      "examples": [
        "minidom.parseString(userXML)"
      ],
      "cwe": ["CWE-611"],
      "remediation": "使用defusedxml库"
    },
    {
      "name": "json_loads",
      "pattern": "json\\.loads\\(",
      "vuln_types": ["prototype_pollution"],
      "description": "json.loads - 原型链污染(通过__proto__)",
      "dangerous_param": 0,
      "modules": ["json"],
      "examples": [
        "json.loads('{\"__proto__\": {\"admin\": true}}')"
      ],
      "cwe": ["CWE-1321"],
      "remediation": "验证JSON结构，过滤__proto__属性"
    },
    {
      "name": "redirect",
      "pattern": "(?:redirect|HttpResponseRedirect)\\(",
      "vuln_types": ["open_redirect"],
      "description": "HTTP重定向 - 开放重定向",
      "dangerous_param": 0,
      "modules": ["flask", "django"],
      "examples": [
        "redirect(userUrl)",
        "HttpResponseRedirect(nextUrl)"
      ],
      "cwe": ["CWE-601"],
      "remediation": "验证URL，使用白名单"
    },
    {
      "name": "redis_eval",
      "pattern": "redis\\.eval\\(",
      "vuln_types": ["rce"],
      "description": "Redis EVAL - Lua代码执行",
      "dangerous_param": 0,
      "modules": ["redis"],
      "examples": [
        "redis.eval(userScript)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免执行用户控制的Lua脚本"
    },
    {
      "name": "template_render",
      "pattern": "(?:mako|cheetah|tornado)\\.Template\\(",
      "vuln_types": ["ssti"],
      "description": "模板引擎渲染 - SSTI",
      "dangerous_param": 0,
      "modules": ["mako", "cheetah", "tornado"],
      "examples": [
        "mako.Template(userTemplate)",
        "tornado.Template(userString)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免渲染用户控制的模板"
    },
    {
      "name": "make_response",
      "pattern": "(?:make_response|Response)\\(",
      "vuln_types": ["xss"],
      "description": "HTTP响应 - XSS",
      "dangerous_param": null,
      "modules": ["flask", "django"],
      "examples": [
        "make_response(userInput)",
        "Response('<div>' + name + '</div>')"
      ],
      "cwe": ["CWE-79"],
      "remediation": "对输出进行HTML编码"
    },
    {
      "name": "json_response",
      "pattern": "(?:jsonify|JsonResponse)\\(",
      "vuln_types": ["xss"],
      "description": "JSON响应 - XSS",
      "dangerous_param": 0,
      "modules": ["flask", "django"],
      "examples": [
        "jsonify({'data': userInput})",
        "JsonResponse({'result': data})"
      ],
      "cwe": ["CWE-79"],
      "remediation": "JSON响应相对安全，但需检查客户端"
    },
    {
      "name": "popen2",
      "pattern": "popen2\\.",
      "vuln_types": ["command_injection"],
      "description": "popen2模块 - 命令注入（已废弃）",
      "dangerous_param": null,
      "modules": ["popen2"],
      "examples": [
        "popen2.popen3(userCommand)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用subprocess模块"
    },
    {
      "name": "asyncio_create_subprocess",
      "pattern": "asyncio\\.(?:create_subprocess|create_subprocess_shell)\\(",
      "vuln_types": ["command_injection", "rce"],
      "description": "asyncio创建子进程 - 命令注入",
      "dangerous_param": 0,
      "modules": ["asyncio"],
      "examples": [
        "asyncio.create_subprocess_shell(userCommand)"
      ],
      "cwe": ["CWE-78"],
      "remediation": "使用create_subprocess_exec，避免shell=True"
    },
    {
      "name": "pty_spawn",
      "pattern": "pty\\.spawn\\(",
      "vuln_types": ["command_injection"],
      "description": "pty.spawn - 命令注入",
      "dangerous_param": 0,
      "modules": ["pty"],
      "examples": [
        "pty.spawn(['sh', '-c', userCommand])"
      ],
      "cwe": ["CWE-78"],
      "remediation": "避免使用pty执行用户命令"
    },
    {
      "name": "timeit_timeit",
      "pattern": "timeit\\.timeit\\(",
      "vuln_types": ["code_injection"],
      "description": "timeit.timeit - 代码执行",
      "dangerous_param": null,
      "modules": ["timeit"],
      "examples": [
        "timeit.timeit(userStmt)"
      ],
      "cwe": ["CWE-94"],
      "remediation": "避免执行用户代码"
    }
  ]
}
